from userbot.other.emojis_index import indexs
from userbot.functions.helper import rand_string
from userbot.utils import shuffle
from PIL import Image
import random
import os
import Config

class Captcha:
    def init(
        self,
        rotate=True,
        output=None,
    ):
        self.emojis = ['ğŸƒ', 'ğŸ¤', 'ğŸ¥', 'ğŸ¨', 'ğŸ©', 'ğŸ¬', 'ğŸ­', 'ğŸ®', 'ğŸ¯', 'ğŸ±', 'ğŸ²', 'ğŸ·', 'ğŸ¸', 'ğŸ¹', 'ğŸ¾', 'ğŸ€', 'ğŸ†', 'ğŸˆ', 'ğŸ‰', 'ğŸ', 'ğŸ“', 'ğŸ’ ', 'ğŸ’¡', 'ğŸ’£', 'ğŸ’¨', 'ğŸ’¸', 'ğŸ’»', 'ğŸ’¾', 'ğŸ’¿', 'ğŸ“ˆ', 'ğŸ“‰', 'ğŸ“Š', 'ğŸ“Œ', 'ğŸ“', 'ğŸ“', 'ğŸ“', 'ğŸ“', 'ğŸ“', 'ğŸ“Ÿ', 'ğŸ“ ', 'ğŸ“¡', 'ğŸ“¢', 'ğŸ“£', 'ğŸ“¦', 'ğŸ“¹', 'ğŸ“º', 'ğŸ“»', 'ğŸ“¼', 'ğŸ“½', 'ğŸ–¥', 'ğŸ–¨', 'ğŸ–²', 'ğŸ—‚', 'ğŸ—ƒ', 'ğŸ—„', 'ğŸ—œ', 'ğŸ—', 'ğŸ—¡', 'ğŸš§', 'ğŸš¨', 'ğŸ›’', 'ğŸ› ', 'ğŸ›¢', 'ğŸ§€', 'ğŸŒ­', 'ğŸŒ®', 'ğŸŒ¯', 'ğŸŒº', 'ğŸŒ»', 'ğŸŒ¼', 'ğŸŒ½', 'ğŸŒ¾', 'ğŸŒ¿', 'ğŸŠ', 'ğŸ‹', 'ğŸŒ', 'ğŸ', 'ğŸ', 'ğŸ', 'ğŸš', 'ğŸ›', 'ğŸœ', 'ğŸ', 'ğŸ', 'ğŸŸ', 'ğŸª', 'ğŸ«', 'ğŸ¬', 'ğŸ­', 'ğŸ®', 'ğŸ¯', 'ğŸº', 'ğŸ»', 'ğŸ¼', 'ğŸ½', 'ğŸ¾', 'ğŸ¿', 'ğŸŠ', 'ğŸ‹', 'ğŸ', 'ğŸ', 'ğŸš', 'ğŸ›', 'ğŸ', 'ğŸŒ', 'ğŸ', 'ğŸ', 'ğŸš', 'ğŸ›', 'ğŸ', 'ğŸ', 'ğŸŸ', 'ğŸ¬', 'ğŸ­', 'ğŸ®', 'ğŸ¯', 'ğŸ»', 'ğŸ¼', 'ğŸ¿', 'ğŸ‘›', 'ğŸ‘œ', 'ğŸ‘', 'ğŸ‘', 'ğŸ‘Ÿ', 'ğŸ’Š', 'ğŸ’‹', 'ğŸ’', 'ğŸ’', 'ğŸ”‹', 'ğŸ”Œ', 'ğŸ”ª', 'ğŸ”«', 'ğŸ”¬', 'ğŸ”­', 'ğŸ”®', 'ğŸ•¯', 'ğŸ–Š', 'ğŸ–‹', 'ğŸ–Œ', 'ğŸ–', 'ğŸ¥š', 'ğŸ¥›', 'ğŸ¥œ', 'ğŸ¥', 'ğŸ¥', 'ğŸ¦Š', 'ğŸ¦‹', 'ğŸ¦Œ', 'ğŸ¦', 'ğŸ¦', 'ğŸ¦', 'ğŸŒ€', 'ğŸŒ‚', 'ğŸŒ‘', 'ğŸŒ•', 'ğŸŒ¡', 'ğŸŒ¤', 'â›…ï¸', 'ğŸŒ¦', 'ğŸŒ§', 'ğŸŒ¨', 'ğŸŒ©', 'ğŸŒ°', 'ğŸŒ±', 'ğŸŒ²', 'ğŸŒ³', 'ğŸŒ´', 'ğŸŒµ', 'ğŸŒ¶', 'ğŸŒ·', 'ğŸŒ¸', 'ğŸŒ¹', 'ğŸ€', 'ğŸ', 'ğŸ‚', 'ğŸƒ', 'ğŸ„', 'ğŸ…', 'ğŸ†', 'ğŸ‡', 'ğŸˆ', 'ğŸ‰', 'ğŸ', 'ğŸ‘', 'ğŸ’', 'ğŸ“', 'ğŸ”', 'ğŸ•', 'ğŸ–', 'ğŸ—', 'ğŸ˜', 'ğŸ™', 'ğŸ ', 'ğŸ¡', 'ğŸ¢', 'ğŸ£', 'ğŸ¤', 'ğŸ¥', 'ğŸ¦', 'ğŸ§', 'ğŸ¨', 'ğŸ©', 'ğŸ°', 'ğŸ±', 'ğŸ²', 'ğŸ´', 'ğŸµ', 'ğŸ¶', 'ğŸ·', 'ğŸ¸', 'ğŸ¹', 'ğŸ€', 'ğŸ', 'ğŸ‚', 'ğŸƒ', 'ğŸ„', 'ğŸˆ', 'ğŸ‰', 'ğŸ’', 'ğŸ“', 'ğŸ™', 'ğŸ€', 'ğŸ', 'ğŸ‚', 'ğŸƒ', 'ğŸ„', 'ğŸ…', 'ğŸ†', 'ğŸ‡', 'ğŸ•', 'ğŸ‰', 'ğŸ“', 'ğŸ–', 'ğŸ—', 'ğŸ˜', 'ğŸ™', 'ğŸ ', 'ğŸ¡', 'ğŸ¢', 'ğŸ£', 'ğŸ¤', 'ğŸ¥', 'ğŸ¦', 'ğŸ§', 'ğŸ¨', 'ğŸ©', 'ğŸ°', 'ğŸ±', 'ğŸ´', 'ğŸµ', 'ğŸ¶', 'ğŸ·', 'ğŸ¸', 'ğŸ¹', 'ğŸ‘\u200dğŸ—¨', 'ğŸ‘‘', 'ğŸ‘’', 'ğŸ‘ ', 'ğŸ‘¡', 'ğŸ‘¢', 'ğŸ’„', 'ğŸ’ˆ', 'ğŸ”—', 'ğŸ”¥', 'ğŸ”¦', 'ğŸ”§', 'ğŸ”¨', 'ğŸ”©', 'ğŸ”°', 'ğŸ”±', 'ğŸ•°', 'ğŸ•¶', 'ğŸ•¹', 'ğŸ–‡', 'ğŸš€', 'ğŸ¤–', 'ğŸ¥€', 'ğŸ¥', 'ğŸ¥‚', 'ğŸ¥ƒ', 'ğŸ¥', 'ğŸ¥‘', 'ğŸ¥’', 'ğŸ¥“', 'ğŸ¥”', 'ğŸ¥•', 'ğŸ¥–', 'ğŸ¥—', 'ğŸ¥˜', 'ğŸ¥™', 'ğŸ¦€', 'ğŸ¦', 'ğŸ¦‚', 'ğŸ¦ƒ', 'ğŸ¦„', 'ğŸ¦…', 'ğŸ¦†', 'ğŸ¦‡', 'ğŸ¦ˆ', 'ğŸ¦‰', 'ğŸ¦', 'ğŸ¦‘', 'â­ï¸', 'â°', 'â²', 'âš ï¸', 'âš¡ï¸', 'âš°ï¸', 'âš½ï¸', 'âš¾ï¸', 'â›„ï¸', 'â›…ï¸', 'â›ˆ', 'â›', 'â›“', 'âŒšï¸', 'â˜ï¸', 'âšœï¸', 'âœï¸', 'âŒ¨ï¸', 'â˜ï¸', 'â˜ƒï¸', 'â˜„ï¸', 'â˜•ï¸', 'â˜˜ï¸', 'â˜ ï¸', 'â™¨ï¸', 'âš’', 'âš”ï¸', 'âš™ï¸', 'âœˆï¸', 'âœ‰ï¸', 'âœ’ï¸']
        self.rotate = rotate
        self.output = output

    def generate(self):
        new = Image.new('RGBA', (300, 300), (random.randint(50, 200), random.randint(50, 200), random.randint(50, 200)))
        pimages = []
        emoji_names = []
        emojis = shuffle(self.emojis)
        others = emojis
        for i in range(9):
            index = indexs.get(emojis[i])
            file = os.path.join(f"{Config.CURRENT_DIR}/userbot/other/emojis/",  f"{index}.png")
            if not os.path.exists(file):
                continue
            emoji_names.append(emojis[i]) 
            pimages.append(file)
            others.remove(emojis[i])
        position = [(20, 20), (100, 20), (180, 20), (20, 100), (100, 100), (180, 100), (20, 180), (100, 180), (180, 180)]
        for i in range(len(pimages)):
            img = Image.open(pimages[i])
            if self.rotate:
                img.rotate(random.randint(0, 360), resample=Image.BICUBIC, expand=True)
            img.thumbnail((100, 100), Image.ANTIALIAS)
            new.paste(img, (position[i]), img)
        outfile = self.output if self.output else rand_string() + ".png"
        newpath = os.path.join(f"{Config.CURRENT_DIR}/userbot/other/emojis/",  outfile)
        new.save(newpath, "PNG")
        return {"answer": emoji_names, "others": others, "captcha": newpath}
