#!/bin/bash

_run_python_code() {
    python3${pVer%.*} -c "$1"
}

_run_aliengit() {
    $(_run_python_code 'from git import Repo
import sys
OFFICIAL_UPSTREAM_REPO= "https://github.com/MxAboli/UserBot"
ACTIVE_BRANCH_NAME = "master"
repo = Repo.init()
origin = repo.create_remote("temponame", OFFICIAL_UPSTREAM_REPO)
origin.fetch()
repo.create_head(ACTIVE_BRANCH_NAME, origin.refs[ACTIVE_BRANCH_NAME])
repo.heads[ACTIVE_BRANCH_NAME].checkout(True)')
}

_run_alien() {
    $(_run_python_code 'import glob
files = glob.glob("../*")
files.remove("../UserBot-master")
 os.remove([file for file in files])
os.rename("../UserBot-master", "../Alien")'
}

_start_bot () {
    local zippath
    zippath="alien.zip"
    echo "• Downloading Source Code . . ."
    wget -q "https://github.com/MxAboli/UserBot/archive/master.zip" -O "$zippath"
    echo "• Unpacking Source Code . . ."
    ALIENPATH=$(zipinfo -1 "$zippath" | grep -v "/.");
    unzip -qq "$zippath"
    echo "• Successfuly Unpacking Source Code . . ."
    cd $ALIENPATH
    _run_aliengit
    echo "• Cleaning . . ."
    _run_alien
    echo "•   Starting Alien Userbot   •"
    python3 -m userbot
}

_start_bot
